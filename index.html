<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Shooting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="./assets/css/normalize.css">
</head>
<style>
    @font-face {
        font-family: 'UhBeeDongKyung';  /*어비동경체*/
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_five@.2.0/UhBeeDongKyung.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

    body{background: #000; color: #fff;}

    /* body{font-family: 'UhBeeDongKyung';} */
    html, body{height: 100%;}
    header{margin-bottom: 10px; background: darkgray; padding: 10px; display: flex; align-items: center; justify-content: space-between;}
    header h1{margin: 0; padding: 0;}
    .start{
        background: #00f; color: #fff; border-radius: 5px; border: 0; padding: 10px 20px; font-weight: 900;
        display: inline-flex; align-items: center; justify-content: center;
    } 

    .wrapper2{width: 280px; margin: 0 auto;}

    .guide{margin: 0; margin-bottom: 5px; font-size: 16px;}

    .board{
        width: 280px; height: 280px; box-sizing: border-box; margin: 0 auto 10px; position: relative;
        display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 900;
        /*box-shadow: inset 0 0 10px #fff;*/ border: 2px dashed #fff;
    }

    .board > .lv1{background: radial-gradient(#fff, transparent); transform: scale(0); box-shadow: 0 0 20px #fff;}

    .status{list-style: none; margin: 0; padding: 0; display: none;}
    .status.on{display: block;}

    .scores, .bullets{display: inline-flex;}
    .scores > div{
        width: 15px; height: 15px; border-radius: 50%; background: radial-gradient(#fff, transparent); box-shadow: 0 0 20px #fff;
        margin-right: 5px;
    }
    .bullets > div{
        width: 8px; height: 15px; border-radius: 50% 50% 0 0; background: #c1af4c; transform: rotate(45deg); margin-right: 7px;
        position: relative; top: 0;
    }

    .bullets > div:last-child{margin-right: 0;}
    .bullet.off{opacity: 0;  top: 5px; transition: opacity .5s, top .5s;}


    @keyframes lv1{
        from{transform: scale(1);}
        to{transform: scale(0);}
    }

    @keyframes circle{
        to{transform: scale(1.5);}
    }
    @keyframes bar1{
        to{
            transform: rotate(45deg) scaleX(1.5);
            opacity: 0;
        }
    }
    @keyframes bar2{
        to{
            transform: rotate(45deg) scale(0);
            opacity: 0;
        }
    }


    @keyframes zoomOut{
        from{transform: scale(1); opacity: 1;}
        to{transform: scale(.1); opacity: 0;}
    }
    @keyframes bullet{
        from{top: 100px; width: 12px; height: 100px; opacity: 1;}
        to{top: 15px; width: 8px; height: 15px;}
    }

</style>
<body>
    <div class="wrapper">
        <header>
            <h1 class="logo">Sh..ting</h1>
            <div><button class="start" onclick="shoot.startGame();">시작</button></div>
        </header>
        <div class="wrapper2">
            <h2 id="guide" class="guide">시작버튼을 눌러주세요.</h2>
            <div id="board" class="board" data-id="board"></div>
            <ul id="state" class="status">
                <li>맞힌 표적: <span id="score" class="scores"></span></li>
                <li>총알: <span id="bullets" class="bullets"></span></li>
            </ul>
        </div>
    </div>

    <script>
        const qs = function(t){return document.querySelector(t);}
        const qsa = function(t){return document.querySelectorAll(t);}
        function getRandomNum(mn, mx){return Math.floor(Math.random() * (mx - mn + 1)) + mn;};

        const shoot = new Shoot();

        function Shoot(){
            const t = this;
            
            t.mode = 0;
            t.delay = 0;
            t.targetIdx = 0;
            t.missCnt = 0;
            t.shootCnt = 0;

            t.isStart = false;
            t.isGameOver = false;

            t.startGame = function(){
                if(t.isStart) return;

                t.initValue();
                t.isStart = true;

                qs('#guide').innerHTML = '표적을 맞혀주세요(1/10)';
                qs('#state').classList.add('on');

                for(let i = 0; i < 15; i++){
                    const div = document.createElement('div');
                    div.classList.add('bullet');
                    qs('#bullets').appendChild(div);
                }
                
                for(let i = 0; i < 10; i++){
                    const delay = getRandomNum(0, 3000);

                    const div = document.createElement('div');

                    div.dataset.id = 'target';
                    div.classList.add('lv1');

                    div.style.cssText = `
                        width: 50px;
                        height: 50px;
                        border-radius: 50%;
                        position: absolute;
                        top: ${getRandomNum(5, qs('#board').clientHeight - 55)}px;
                        left: ${getRandomNum(5, qs('#board').clientWidth - 55)}px;
                        animation: lv1 .5s ${(t.delay + delay + 1500) / 1000}s ease-in-out alternate;
                    `;
                    
                    div.addEventListener('animationend', (event) => {
                        t.targetIdx++;
                        if(t.targetIdx == 10) t.gameOver();
                        else qs('#guide').innerHTML = '표적을 맞혀주세요(' + (t.targetIdx + 1) + '/10)';
                    });
                    
                    qs('#board').appendChild(div);
                    
                    t.delay += (delay + 1500);
                }
            }

            t.initValue = function(){
                t.mode = t.delay = t.targetIdx = t.missCnt = t.shhtCnt = 0;
                t.isStart = t.isGameOver = false;

                qs('#guide').innerHTML = '시작버튼을 눌러주세요.';

                qs('#board').innerHTML = '';
                qs('#score').innerHTML = '';
                qs('#bullets').innerHTML = '';

                qs('#state').classList.remove('on');
            }

            t.gameOver = function(){
                qs('#guide').innerHTML = '게임이 끝났습니다.';
                qs('#board').innerHTML = 'GAME OVER';

                t.isGameOver = true;
                t.isStart = false;
            }

        }

        qs('#board').addEventListener('click', function(e){
            fnc1(e, 'click');
        })
        qs('#board').addEventListener('touchend', function(e){
            e.preventDefault();
            fnc1(e, 'touch');
        });


        function fnc1(e, type){
           if(shoot.isGameOver){
                alert('게임이 끝났습니다.\n시작버튼을 눌러주세요.');
                return;
            }

            let target;
            if(type == 'touch') target = e.changedTouches[0];
            else if(type == 'click') target = e;

            const div = document.createElement('div');
            const div2 = document.createElement('div');
            const div3 = document.createElement('div');
            const div4 = document.createElement('div');
            const div5 = document.createElement('div');
            const div6 = document.createElement('div');
            const div7 = document.createElement('div');

            div.style.cssText = `
                position: fixed;
                top: ${target.pageY}px;
                left: ${target.pageX}px;
                width: 30px;
                height: 30px;
                margin-left: -15px;
                margin-top: -15px;
                transform: scale(.5);
                opacity: 0;
                animation: zoomOut .5s ease-in-out alternate;
            `;

            div2.style.cssText = `
                width: 10px;
                height: 10px;
                position: absolute;
                top: 0;
                left: 0;
                box-sizing: border-box;
                border: 2px solid rgba(255, 255, 255, .5);
                border-right: 0;
                border-bottom: 0;
            `;
            div3.style.cssText = `
                width: 10px;
                height: 10px;
                position: absolute;
                top: 0;
                right: 0;
                box-sizing: border-box;
                border: 2px solid rgba(255, 255, 255, .5);
                border-left: 0;
                border-bottom: 0;
            `;
            div4.style.cssText = `
                width: 10px;
                height: 10px;
                position: absolute;
                bottom: 0;
                right: 0;
                box-sizing: border-box;
                border: 2px solid rgba(255, 255, 255, .5);
                border-top: 0;
                border-left: 0;
            `;
            div5.style.cssText = `
                width: 10px;
                height: 10px;
                position: absolute;
                left: 0;
                bottom: 0;
                box-sizing: border-box;
                border: 2px solid rgba(255, 255, 255, .5);
                border-top: 0;
                border-right: 0;
            `;
                
            div6.style.cssText = `
                width: 5px;
                height: 5px;
                border-radius: 50%;
                background: #fff;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            `;
            div7.style.cssText = `
                width: 1px;
                height: 3px;
                background: linear-gradient(#c1af4c, transparent);
                opacity: 0;
                position: absolute;
                top: 15px;
                left: 50%;
                border-radius: 50% 50% 0 0;
                transform: translateX(-50%);
                animation: bullet .2s ease-in-out alternate;
            `;

            div.appendChild(div2);
            div.appendChild(div3);
            div.appendChild(div4);
            div.appendChild(div5);
            div.appendChild(div6);
            div.appendChild(div7);

            div.addEventListener('animationend', function(){
                this.remove();
            })
            

            qs('#board').appendChild(div);

            targetProcess(e);
        }

        function fnc2(obj){
            const div = document.createElement('div');
            const div2 = document.createElement('div');
            const div3 = document.createElement('div');

            div.style.cssText = `
                position: absolute;
                top: ${obj.top};
                left: ${obj.left};
                width: 30px;
                height: 30px;
                margin-top: 10px;
                margin-left: 10px;
                background: radial-gradient(rgba(255, 255, 255, .1), transparent, transparent);
                border: 1px solid rgba(255, 255, 255, .8);
                transform: scale(0);    
                border-radius: 50%;
                animation: circle .5s ease-in-out alternate;
            `;
                
            div2.style.cssText = `
                width: 120px;
                height: 2px;
                background: #0ff;
                position: absolute;
                top: 50%;
                left: 50%;
                margin-top: -1px;
                margin-left: -60px;
                transform: rotate(-45deg);
                box-sizing: border-box;
                border-left: 0;
                border-right: 0;
                animation: bar1 .5s ease-in-out alternate;
            `;
            
            div3.style.cssText = `
                width: 100px;
                height: 2px;
                position: absolute;
                top: 50%;
                left: 50%;
                box-sizing: border-box;
                border-left: 10px solid rgba(255, 0, 0, .5);
                border-right: 10px solid rgba(255, 0, 0, .5);
                margin-top: -1px;
                margin-left: -50px;
                transform: rotate(45deg) scale(1.2);
                animation: bar2 .5s .2s ease-in-out alternate;
            `;

            div.appendChild(div2);
            div.appendChild(div3);

            div.addEventListener('animationend', function(){
                this.remove();
            })
            

            qs('#board').appendChild(div);
        }

        function targetProcess(e){
            const bullets = qs('#bullets').querySelectorAll('.bullet:not(.off)');
            const id = e.target.dataset.id;

            bullets[bullets.length - 1].classList.add('off');


            if(!(bullets.length - 1)){
                shoot.gameOver();
                return;
            }

            if(id === 'board'){
                shoot.missCnt++;
                
            }else if(id === 'target'){
                fnc2({
                    top: e.target.style.top,
                    left: e.target.style.left
                });
                e.target.remove();
                shoot.shootCnt++;
                shoot.targetIdx++;
                
                const shooted = document.createElement('div');
                shooted.classList.add('score');
                qs('#score').appendChild(shooted);
                if(shoot.targetIdx == 10){
                    shoot.gameOver();
                    return;
                }else{
                    qs('#guide').innerHTML = '표적을 맞혀주세요(' + (shoot.targetIdx + 1) + '/10)';
                }
            }
        }


    </script>



</body>
</html>