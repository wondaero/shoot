<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Shooting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="./assets/css/normalize.css">
</head>
<style>
    @font-face {
        font-family: 'UhBeeDongKyung';  /*어비동경체*/
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_five@.2.0/UhBeeDongKyung.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

    body{background: #000; color: #fff;}

    /* body{font-family: 'UhBeeDongKyung';} */
    html, body{height: 100%;}
    header{margin-bottom: 10px; background: darkgray; padding: 10px; display: flex; align-items: center; justify-content: space-between;}
    header h1{margin: 0; padding: 0;}
    .start{
        background: #00f; color: #fff; border-radius: 5px; border: 0; padding: 10px 20px; font-weight: 900;
        display: inline-flex; align-items: center; justify-content: center;
    } 

    .wrapper2{width: 280px; margin: 0 auto;}

    .guide{margin: 0; margin-bottom: 5px; font-size: 16px;}

    .board{
        width: 280px; height: 280px; box-sizing: border-box; margin: 0 auto 10px; position: relative;
        display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 900;
        box-shadow: inset 0 0 10px #fff; border-radius: 5px;
    }

    .board > div{background: radial-gradient(#0f0, transparent); transform: scale(0); box-shadow: 0 0 20px #0f0;}

    .status{list-style: none; margin: 0; padding: 0; display: none;}
    .status.on{display: block;}

    .scores, .bullets{display: inline-flex;}
    .scores > div{
        width: 15px; height: 15px; border-radius: 50%; background: radial-gradient(#0f0, transparent); box-shadow: 0 0 20px #0f0;
        margin-right: 5px;
    }
    .bullets > div{
        width: 8px; height: 15px; border-radius: 50% 50% 0 0; background: #c1af4c; transform: rotate(45deg); margin-right: 7px;
        position: relative; top: 0;
    }

    .bullets > div:last-child{margin-right: 0;}
    .bullet.off{opacity: 0;  top: 5px; transition: opacity .5s, top .5s;}


    @keyframes lv1{
        from{transform: scale(1);}
        to{transform: scale(0);}
    }

</style>
<body>
    <div class="wrapper">
        <header>
            <h1 class="logo">Shooting</h1>
            <div><button class="start" onclick="shoot.startGame();">시작</button></div>
        </header>
        <div class="wrapper2">
            <h2 id="guide" class="guide">시작버튼을 눌러주세요.</h2>
            <div id="board" class="board"></div>
            <ul id="state" class="status">
                <li>맞힌 표적: <span id="score" class="scores"></span></li>
                <li>총알: <span id="bullets" class="bullets"></span></li>
            </ul>
        </div>
    </div>

    <script>
        const qs = function(t){return document.querySelector(t);}
        const qsa = function(t){return document.querySelectorAll(t);}
        function getRandomNum(mn, mx){return Math.floor(Math.random() * (mx - mn + 1)) + mn;};

        const shoot = new Shoot();

        function Shoot(){
            const t = this;
            
            t.mode = 0;
            t.delay = 0;
            t.targetIdx = 0;
            t.missCnt = 0;
            t.shootCnt = 0;

            t.isStart = false;
            t.isGameOver = false;

            t.startGame = function(){
                if(t.isStart) return;

                t.initValue();
                t.isStart = true;

                qs('#guide').innerHTML = '표적을 맞혀주세요(1/10)';
                qs('#state').classList.add('on');

                for(let i = 0; i < 15; i++){
                    const div = document.createElement('div');
                    div.classList.add('bullet');
                    qs('#bullets').appendChild(div);
                }
                
                for(let i = 0; i < 10; i++){
                    const delay = getRandomNum(0, 3000);
                    const div = document.createElement('div');
                    div.setAttribute('id', 'target');
                    div.classList.add('lv1');
                    div.style.cssText = `
                        width: 50px;
                        height: 50px;
                        border-radius: 50%;
                        position: absolute;
                        top: ${getRandomNum(5, qs('#board').clientHeight - 55)}px;
                        left: ${getRandomNum(5, qs('#board').clientWidth - 55)}px;
                        animation: lv1 8s ${(t.delay + delay + 1500) / 1000}s ease-in-out alternate;
                    `;
                    div.addEventListener('animationend', (event) => {
                        t.targetIdx++;
                        if(t.targetIdx == 10){
                            t.gameOver();
                        }else{
                            qs('#guide').innerHTML = '표적을 맞혀주세요(' + (t.targetIdx + 1) + '/10)';
                        }
                    });
                    
                    qs('#board').appendChild(div);
                    
                    t.delay += (delay + 1500);
                }
            }

            t.initValue = function(){
                t.mode = t.delay = t.targetIdx = t.missCnt = t.shhtCnt = 0;
                t.isStart = t.isGameOver = false;

                qs('#guide').innerHTML = '시작버튼을 눌러주세요.';

                qs('#board').innerHTML = '';
                qs('#score').innerHTML = '';
                qs('#bullets').innerHTML = '';

                qs('#state').classList.remove('on');
            }

            t.gameOver = function(){
                qs('#guide').innerHTML = '게임이 끝났습니다.';
                qs('#board').innerHTML = 'GAME OVER';

                t.isGameOver = true;
                t.isStart = false;
            }

        }

        qs('#board').addEventListener('click', function(e){
            if(shoot.isGameOver){
                alert('게임이 끝났습니다.\n시작버튼을 눌러주세요.');
                return;
            }

            const bullets = qs('#bullets').querySelectorAll('.bullet:not(.off)');
            const id = e.target.id;

            bullets[bullets.length - 1].classList.add('off');
            if(!(bullets.length - 1)){
                shoot.gameOver();
                return;
            }

            if(id === 'board'){
                shoot.missCnt++;
                
            }else if(id === 'target'){
                e.target.remove();
                shoot.shootCnt++;
                shoot.targetIdx++;
                
                const div = document.createElement('div');
                div.classList.add('score');
                qs('#score').appendChild(div);
                if(shoot.targetIdx == 10){
                    shoot.gameOver();
                    return;
                }else{
                    qs('#guide').innerHTML = '표적을 맞혀주세요(' + (shoot.targetIdx + 1) + '/10)';
                }
                            

            }
        })

    </script>



</body>
</html>